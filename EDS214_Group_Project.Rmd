---
title: "EDS 214 Group Project"
output: html_document
date: "2022-08-24"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(here)
library(devtools)
library(DiagrammeR)

```

## Workflow

```{r}
DiagrammeR::grViz(diagram = "digraph flowchart {
node [Title = Workflow, fontname = Arial, shape = oval, color = grey, style = filled]
  tab1 [label = '@@1']
  tab2 [label = '@@2']
  tab3 [label = '@@3']
  tab4 [label = '@@4']
  tab5 [label = '@@5']
  tab6 [label = '@@6']
  tab7 [label = '@@7']
  tab8 [label = '@@8']
  tab9 [label = '@@9']
  tab10 [label = '@@10']
  
  
  tab1 -> tab2; 
  tab2 -> tab3; 
  tab2 -> tab4;
  tab3 -> tab7; 
  tab2 -> tab6; 
  tab6 -> tab7;
  tab2 -> tab5; 
  tab5 -> tab7; 
  tab4 -> tab7;
  tab7 -> tab8;
  tab8 -> tab9; 
  tab9 -> tab10
  
}
  
  [1]: 'Set up GitHub Repository/Add Collaborators'
  [2]: 'Read in the Data'    
  [3]: 'PRM'
  [4]: 'BQ1'
  [5]: 'BQ2'
  [6]: 'BQ3'
  [7]: 'Clean Data'
  [8]: 'Join Data'
  [9]: 'Create Subsets and Plots for Potassium and Nitrate'
  [10]: 'Combine Potassium and Nitrate Plots'
")
```




## Read in the Data

```{r, message = FALSE, warning = FALSE}
#read in raw data 
PRM <- read_csv(here('/courses/EDS214/gg_girls/raw_data','RioMameyesPuenteRoto.csv'))
BQ1 <- read_csv(here('/courses/EDS214/gg_girls/raw_data', 'QuebradaCuenca1-Bisley.csv'))
BQ2 <- read_csv(here('/courses/EDS214/gg_girls/raw_data', 'QuebradaCuenca2-Bisley.csv'))
BQ3 <- read_csv(here('/courses/EDS214/gg_girls/raw_data', 'QuebradaCuenca2-Bisley.csv'))
```

## Clean the Data

```{r}
#select data for relevant variables (data cleaning)
PRM_clean <- PRM %>% 
  select(Sample_Date, `NO3-N`, K, `NH4-N`, Sample_ID)
BQ1_clean <- BQ1 %>% 
  select(Sample_Date, `NO3-N`, K, `NH4-N`, Sample_ID)
BQ2_clean <- BQ2 %>% 
  select(Sample_Date, `NO3-N`, K, `NH4-N`, Sample_ID)
BQ3_clean <- BQ3 %>% 
  select(Sample_Date, `NO3-N`, K, `NH4-N`, Sample_ID)|>
  mutate(Sample_ID = "Q3")
  
```

## Join the Cleaned Data

```{r}
#joining cleaned data
Joined <- bind_rows(BQ1_clean, BQ2_clean, BQ3_clean, PRM_clean) 

#add month, year, and month-year columns to joined data
Joined <- Joined %>% 
  mutate(Year = lubridate::year(Sample_Date), Month = lubridate::month(Sample_Date), monthyear = zoo::as.yearmon(paste(Year, Month), "%Y %m")) 

#subset joined data to select for years 1989-1992
Joined_Sub <- Joined %>% 
  filter(Year >=1989 & Year <= 1994)
```

## Potassium Subset (1988-1994)

```{r}
#Potassium (subset) :
#add mean K values to joined subset data 
 Joined_Sub_K <- Joined_Sub %>% 
  group_by(monthyear, Sample_ID) %>% 
  mutate(meanK = mean(K, na.rm=TRUE)) %>% 
  select(Sample_ID, monthyear, meanK) %>% 
  distinct(monthyear, meanK)
```

Potassium Subset Plot

```{r}
#Potassium (subset) :
#create a ggplot of subsetted data
K_subset <- ggplot(data=Joined_Sub_K, aes(x=monthyear, y=meanK)) + 
  geom_line(aes(color=Sample_ID, linetype=Sample_ID)) +
  theme(aspect.ratio = 1/3) 
```

## Nitrate Subset (1988-1994)

```{r}
#Nitrate (subset) :
#add mean N values to joined subset data 
 Joined_Sub_N <- Joined_Sub %>% 
  group_by(monthyear, Sample_ID) %>% 
  mutate(meanN = mean(`NO3-N`, na.rm=TRUE)) %>% 
  select(Sample_ID, monthyear, meanN) %>% 
  distinct(monthyear, meanN)
```

Nitrate Subset Plot

```{r}
#Nitrate (subset) :
#create a ggplot of subsetted data
N_subset <- ggplot(data=Joined_Sub_N, aes(x=monthyear, y=meanN)) + 
  geom_line(aes(color=Sample_ID, linetype=Sample_ID)) +
  theme(aspect.ratio = 1/3) 
```


## Potassium and Nitrate (1986-2018)

```{r}
#Potassium, Nitrate, and Ammonium (all available years)

#add mean K and N values to joined data (including data for all available years)
Joined <- Joined %>% 
  group_by(monthyear, Sample_ID) %>% 
  mutate(meanK = mean(K, na.rm=TRUE), meanN = mean(`NO3-N`, na.rm=TRUE), meanNH = mean(`NH4-N`, na.rm=TRUE)) %>% 
  select(Sample_ID, monthyear, meanK, meanN, meanNH) %>% 
  distinct(monthyear, meanK, meanN, meanNH)
```

Potassium Plot (all years)

```{r}
#Potassium Plot (all available years)
#create a ggplot for all available data 
K_all <- ggplot(data=Joined, aes(x=monthyear, y=meanK)) + 
  geom_line(aes(color=Sample_ID, linetype=Sample_ID)) +
  theme(aspect.ratio = 1/3)

K_all
```

Nitrate Plot (all years)

```{r}
#Nitrate Plot (all available years)
N_all <- ggplot(data=Joined, aes(x=monthyear, y=meanN)) + 
  geom_line(aes(color=Sample_ID, linetype=Sample_ID)) +
  theme(aspect.ratio = 1/3)

N_all
```

```{r}
#Ammonium Plot (all available years)
NH_all <- ggplot(data=Joined, aes(x=monthyear, y=meanNH)) + 
  geom_line(aes(color=Sample_ID, linetype=Sample_ID)) +
  theme(aspect.ratio = 1/3)

NH_all
```
